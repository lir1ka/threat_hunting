# pr 05 vakhrameev
vakhrameevaleksandr@yandex.ru

## –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã

1.  –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞–Ω–∏—è –æ –º–µ—Ç–æ–¥–∞—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Ä–∞–¥–∏–æ—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –æ–±—Å—Ç–∞–Ω–æ–≤–∫–∏.
2.  –°–æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ –º–µ—Ö–∞–Ω–∏–∑–º–∞—Ö —Ä–∞–±–æ—Ç—ã Wi-Fi —Å–µ—Ç–µ–π –Ω–∞ –∫–∞–Ω–∞–ª—å–Ω–æ–º
    –∏ —Å–µ—Ç–µ–≤–æ–º —É—Ä–æ–≤–Ω–µ –º–æ–¥–µ–ª–∏ OSI.
3.  –ó–µ–∫—Ä–µ–ø–∏—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è R
    –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
4.  –ó–∞–∫—Ä–µ–ø–∏—Ç—å –∑–Ω–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã
    tidyverse —è–∑—ã–∫–∞ R

## –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

1.  –û–µ–ø—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ Darwin Mac.lan 25.0.0 Darwin Kernel Version
    25.0.0
2.  IDE Positron
3.  R version 4.5.2
4.  –õ–æ–≥–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã—Ö —Å–µ—Ç–µ–π ‚Äî `tcpdump` –∏
    `airodump-ng`.

## –ó–∞–¥–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –ø–∞–∫–µ—Ç `dplyr` —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è R –ø—Ä–æ–≤–µ—Å—Ç–∏
–∞–Ω–∞–ª–∏–∑ –∂—É—Ä–Ω–∞–ª–æ–≤ –∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

### –•–æ–¥ —Ä–∞–±–æ—Ç—ã

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

1.  –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ
2.  –ü—Ä–∏–≤–µ—Å—Ç–∏ –¥–∞—Ç–∞—Å–µ—Ç—ã –≤ –≤–∏–¥ ‚Äú–∞–∫–∫—É—Ä–∞—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö‚Äù, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Ç–∏–ø—ã
    —Å—Ç–æ–ª–±—Ü–æ–≤ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–∏–ø–æ–º –¥–∞–Ω–Ω—ã—Ö
3.  –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ–±—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ `glimpse()`

### –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö

1.  –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (–±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è ‚Äì OPN)
2.  –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
3.  –í—ã—è–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
    —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è WPA3, –∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ —ç—Ç–∏—Ö
    —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
4.  –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª—É –≤—Ä–µ–º–µ–Ω–∏, –≤ —Ç–µ—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ
    –æ–Ω–∏ –Ω–∞—Ö–æ–¥–∏–ª–∏—Å—å –Ω–∞ —Å–≤—è–∑–∏, –ø–æ —É–±—ã–≤–∞–Ω–∏—é.
5.  –û–±–Ω–∞—Ä—É–∂–∏—Ç—å —Ç–æ–ø-10 —Å–∞–º—ã—Ö –±—ã—Å—Ç—Ä—ã—Ö —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞.
6.  –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —á–∞—Å—Ç–æ—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (beacons) –≤
    –µ–¥–∏–Ω–∏—Ü—É –≤—Ä–µ–º–µ–Ω–∏ –ø–æ –∏—Ö —É–±—ã–≤–∞–Ω–∏—é.
7.  –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.
8.  –û–±–Ω–∞—Ä—É–∂–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï —Ä–∞–Ω–¥–æ–º–∏–∑–∏—Ä—É—é—Ç —Å–≤–æ–π MAC –∞–¥—Ä–µ—Å.
9.  –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∫ —Ç–æ—á–∫–∞–º –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∏—Ö –∏–º–µ–Ω–∞–º.
    –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Ä–µ–º—è –ø–æ—è–≤–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –∑–æ–Ω–µ —Ä–∞–¥–∏–æ–≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º—è
    –≤—ã—Ö–æ–¥–∞ –µ–≥–æ –∏–∑ –Ω–µ–µ.
10. –û—Ü–µ–Ω–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —É—Ä–æ–≤–Ω—è —Å–∏–≥–Ω–∞–ª–∞ –≤–Ω—É—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏.
    –í—ã—è–≤–∏—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä.

### –®–∞–≥ 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–∞–±–æ—á—É—é —Å—Ä–µ–¥—É, –∑–∞–≥—Ä—É–∑–∏–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è
–æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö:

``` r
suppressPackageStartupMessages({
  library(dplyr)
  library(stringr)
  library(tidyr)
  library(knitr)
  library(readr)
})
```

–ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç –∏–∑ –æ–±–ª–∞—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:

``` r
DATA_URL <- "https://storage.yandexcloud.net/dataset.ctfsec/P2_wifi_data.csv"
TEMP_DIR <- tempdir()
DATA_FILE <- file.path(TEMP_DIR, "P2_wifi_data.csv")

if (!file.exists(DATA_FILE)) {
  download.file(url = DATA_URL, destfile = DATA_FILE, mode = "wb")
}
```

–í—ã–ø–æ–ª–Ω—è–µ–º —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ –¥–≤–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞: —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∏
–∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:

``` r
suppressWarnings({
  file_content <- read_lines(DATA_FILE)
  section_boundary <- which(grepl("^Station MAC", file_content, ignore.case = TRUE))
  
  if (length(section_boundary) > 0) {
    wifi_ap_raw <- read_csv(DATA_FILE, n_max = section_boundary[1] - 2, show_col_types = FALSE)
    clients_raw <- read_csv(DATA_FILE, skip = section_boundary[1] - 1, show_col_types = FALSE)
  } else {
    stop("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥—Ä–∞–Ω–∏—Ü—É –º–µ–∂–¥—É —Å–µ–∫—Ü–∏—è–º–∏ –¥–∞–Ω–Ω—ã—Ö")
  }
})

print("–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö:")
```

    [1] "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö:"

``` r
head(clients_raw, 2)
```

    # A tibble: 2 √ó 7
      `Station MAC`  `First time seen`   `Last time seen`    Power `# packets` BSSID
      <chr>          <dttm>              <dttm>              <dbl>       <dbl> <chr>
    1 CA:66:3B:8F:5‚Ä¶ 2023-07-28 09:13:03 2023-07-28 10:59:44   -33         858 BE:F‚Ä¶
    2 96:35:2D:3D:8‚Ä¶ 2023-07-28 09:13:03 2023-07-28 09:13:03   -65           4 (not‚Ä¶
    # ‚Ñπ 1 more variable: `Probed ESSIDs` <chr>

–í—ã–ø–æ–ª–Ω—è–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞ —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞:

``` r
normalize_access_points <- function(df) {
  names(df) <- trimws(names(df))
  
  df %>%
    rename(
      bssid      = BSSID,
      first_seen = `First time seen`,
      last_seen  = `Last time seen`,
      channel    = channel,
      speed      = Speed,
      privacy    = Privacy,
      cipher     = Cipher,
      auth       = Authentication,
      power      = Power,
      beacons    = `# beacons`,
      iv_count   = `# IV`,
      lan_ip     = `LAN IP`,
      id_length  = `ID-length`,
      essid      = ESSID,
      key        = Key
    ) %>%
    mutate(across(where(is.character), ~ trimws(.))) %>%
    mutate(
      first_seen = as.POSIXct(first_seen, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
      last_seen  = as.POSIXct(last_seen,  format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
      channel    = as.numeric(channel),
      speed      = as.numeric(speed),
      power      = as.numeric(power),
      beacons    = as.numeric(beacons),
      iv_count   = as.numeric(iv_count),
      id_length  = as.numeric(id_length)
    )
}

wifi_ap_clean <- normalize_access_points(wifi_ap_raw)
```

    Warning: There were 2 warnings in `mutate()`.
    The first warning was:
    ‚Ñπ In argument: `channel = as.numeric(channel)`.
    Caused by warning:
    ! NAs introduced by coercion
    ‚Ñπ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.

–ü—Ä–∏–º–µ–Ω—è–µ–º –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é –ø—Ä–æ—Ü–µ–¥—É—Ä—É –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö
—É—Å—Ç—Ä–æ–π—Å—Ç–≤:

``` r
normalize_clients <- function(df) {
  names(df) <- trimws(names(df))
  
  df %>%
    rename(
      station_mac   = `Station MAC`,
      first_seen    = `First time seen`,
      last_seen     = `Last time seen`,
      power         = Power,
      packets       = `# packets`,
      bssid         = BSSID,
      probed_essids = `Probed ESSIDs`
    ) %>%
    mutate(across(where(is.character), ~ trimws(.))) %>%
    mutate(
      first_seen  = as.POSIXct(first_seen, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
      last_seen   = as.POSIXct(last_seen,  format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
      power       = as.numeric(power),
      packets     = as.numeric(packets),
      station_mac = toupper(station_mac),
      bssid = case_when(
        is.na(bssid) ~ NA_character_,
        grepl("not associated", bssid, ignore.case = TRUE) ~ NA_character_,
        TRUE ~ toupper(bssid)
      )
    )
}

wifi_clients_clean <- normalize_clients(clients_raw)
```

–ü—Ä–æ–≤–æ–¥–∏–º –∏–Ω—Å–ø–µ–∫—Ü–∏—é —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤:

``` r
cat("–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞ —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞:\n")
```

    –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞ —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞:

``` r
glimpse(wifi_ap_clean)
```

    Rows: 169
    Columns: 15
    $ bssid      <chr> "BE:F1:71:D5:17:8B", "6E:C7:EC:16:DA:1A", "9A:75:A8:B9:04:1‚Ä¶
    $ first_seen <dttm> 2023-07-28 09:13:03, 2023-07-28 09:13:03, 2023-07-28 09:13‚Ä¶
    $ last_seen  <dttm> 2023-07-28 11:50:50, 2023-07-28 11:55:12, 2023-07-28 11:53‚Ä¶
    $ channel    <dbl> 1, 1, 1, 7, 6, 6, 11, 11, 11, 1, 6, 14, 11, 11, 6, 6, 6, 6,‚Ä¶
    $ speed      <dbl> 195, 130, 360, 360, 130, 130, 195, 130, 130, 195, 180, 65, ‚Ä¶
    $ privacy    <chr> "WPA2", "WPA2", "WPA2", "WPA2", "WPA2", "OPN", "WPA2", "WPA‚Ä¶
    $ cipher     <chr> "CCMP", "CCMP", "CCMP", "CCMP", "CCMP", NA, "CCMP", "CCMP",‚Ä¶
    $ auth       <chr> "PSK", "PSK", "PSK", "PSK", "PSK", NA, "PSK", "PSK", "PSK",‚Ä¶
    $ power      <dbl> -30, -30, -68, -37, -57, -63, -27, -38, -38, -66, -42, -62,‚Ä¶
    $ beacons    <dbl> 846, 750, 694, 510, 647, 251, 1647, 1251, 704, 617, 1390, 1‚Ä¶
    $ iv_count   <dbl> 504, 116, 26, 21, 6, 3430, 80, 11, 0, 0, 86, 0, 0, 0, 907, ‚Ä¶
    $ lan_ip     <chr> "0.  0.  0.  0", "0.  0.  0.  0", "0.  0.  0.  0", "0.  0. ‚Ä¶
    $ id_length  <dbl> 12, 4, 2, 14, 25, 13, 12, 13, 24, 12, 10, 0, 24, 24, 12, 0,‚Ä¶
    $ essid      <chr> "C322U13 3965", "Cnet", "KC", "POCO X5 Pro 5G", NA, "MIREA_‚Ä¶
    $ key        <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,‚Ä¶

``` r
cat("\n–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:\n")
```


    –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:

``` r
glimpse(wifi_clients_clean)
```

    Rows: 12,081
    Columns: 7
    $ station_mac   <chr> "CA:66:3B:8F:56:DD", "96:35:2D:3D:85:E6", "5C:3A:45:9E:1‚Ä¶
    $ first_seen    <dttm> 2023-07-28 09:13:03, 2023-07-28 09:13:03, 2023-07-28 09‚Ä¶
    $ last_seen     <dttm> 2023-07-28 10:59:44, 2023-07-28 09:13:03, 2023-07-28 11‚Ä¶
    $ power         <dbl> -33, -65, -39, -61, -53, -43, -31, -71, -74, -65, -45, -‚Ä¶
    $ packets       <dbl> 858, 4, 432, 958, 1, 344, 163, 3, 115, 437, 265, 77, 7, ‚Ä¶
    $ bssid         <chr> "BE:F1:71:D5:17:8B", NA, "BE:F1:71:D6:10:D7", "BE:F1:71:‚Ä¶
    $ probed_essids <chr> "C322U13 3965", "IT2 Wireless", "C322U21 0566", "C322U13‚Ä¶

### –®–∞–≥ 2. –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö

#### 1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (–±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è ‚Äì OPN)

–í—ã–ø–æ–ª–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞ —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º:

``` r
insecure_access_points <- wifi_ap_clean %>%
  filter(privacy == "OPN") %>%
  select(bssid, essid, privacy, channel, power)

insecure_access_points
```

    # A tibble: 42 √ó 5
       bssid             essid         privacy channel power
       <chr>             <chr>         <chr>     <dbl> <dbl>
     1 E8:28:C1:DC:B2:52 MIREA_HOTSPOT OPN           6   -63
     2 E8:28:C1:DC:B2:50 MIREA_GUESTS  OPN           6   -63
     3 E8:28:C1:DC:B2:51 <NA>          OPN           6   -63
     4 E8:28:C1:DC:FF:F2 <NA>          OPN           6    -1
     5 00:25:00:FF:94:73 <NA>          OPN          44    -1
     6 E8:28:C1:DD:04:52 MIREA_HOTSPOT OPN          11   -67
     7 E8:28:C1:DE:74:31 <NA>          OPN           6   -82
     8 E8:28:C1:DE:74:32 MIREA_HOTSPOT OPN           6   -69
     9 E8:28:C1:DC:C8:32 MIREA_HOTSPOT OPN           1   -69
    10 E8:28:C1:DD:04:50 MIREA_GUESTS  OPN          11   -78
    # ‚Ñπ 32 more rows

#### 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ OUI-—Ç–∞–±–ª–∏—Ü—ã
Wireshark:

``` r
MANUF_URL  <- "https://raw.githubusercontent.com/observ3r/wobs/master/manuf.txt"
MANUF_FILE <- file.path(TEMP_DIR, "manuf.txt")

if (!file.exists(MANUF_FILE)) {
  download.file(MANUF_URL, MANUF_FILE, mode = "wb", quiet = TRUE)
}

manuf_raw <- read.table(
  MANUF_FILE,
  comment.char      = "#",
  stringsAsFactors  = FALSE,
  fill              = TRUE
)

manuf_tbl <- manuf_raw %>%
  transmute(
    prefix6 = toupper(gsub(":", "", V1)), 
    vendor  = V2
  ) %>%
  filter(nchar(prefix6) == 6, vendor != "") %>%
  distinct()
```

–†–µ–∞–ª–∏–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ MAC-–∞–¥—Ä–µ—Å–æ–≤:

``` r
normalize_mac <- function(mac_address) {
  toupper(gsub("[^0-9A-F]", "", mac_address))
}
```

–û–±–æ–≥–∞—â–∞–µ–º –¥–∞—Ç–∞—Å–µ—Ç —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è—Ö:

``` r
wifi_ap_clean <- wifi_ap_clean %>%
  mutate(prefix6 = substr(normalize_mac(bssid), 1, 6)) %>%
  left_join(manuf_tbl, by = "prefix6")
```

–í—ã–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π:

``` r
wifi_ap_clean %>%
  select(bssid, essid, vendor) %>%
  filter(!is.na(vendor)) %>%
  head(20)
```

    # A tibble: 20 √ó 3
       bssid             essid   vendor  
       <chr>             <chr>   <chr>   
     1 1C:7E:E5:8E:B7:DE <NA>    D-LinkIn
     2 00:25:00:FF:94:73 <NA>    Apple   
     3 00:26:99:F2:7A:E2 GIVC    Cisco   
     4 48:5B:39:F9:7A:48 <NA>    AsustekC
     5 00:26:99:F2:7A:E1 IKB     Cisco   
     6 00:26:99:BA:75:80 GIVC    Cisco   
     7 00:23:EB:E3:81:F2 GIVC    Cisco   
     8 00:23:EB:E3:81:F1 IKB     Cisco   
     9 00:26:99:F2:7A:E0 <NA>    Cisco   
    10 00:23:EB:E3:81:FE IKB     Cisco   
    11 00:23:EB:E3:81:FD GIVC    Cisco   
    12 00:26:CB:AA:62:71 IKB     Cisco   
    13 00:03:7A:1A:18:56 <NA>    TaiyoYud
    14 00:09:9A:12:55:04 <NA>    Elmo    
    15 00:23:EB:E3:49:31 <NA>    Cisco   
    16 00:23:EB:E3:44:31 <NA>    Cisco   
    17 00:03:7A:1A:03:56 MT_FREE TaiyoYud
    18 00:26:99:BA:75:8F <NA>    Cisco   
    19 00:03:7F:12:34:56 MT_FREE AtherosC
    20 00:26:99:F1:1A:E1 IKB     Cisco   

#### 3. –í—ã—è–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è WPA3, –∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ —ç—Ç–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

–ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ–º —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ WPA3:

``` r
wpa3_access_points <- wifi_ap_clean %>%
  filter(
    grepl("WPA3", privacy, ignore.case = TRUE) | 
    grepl("SAE", auth, ignore.case = TRUE)
  ) %>%
  select(bssid, essid, privacy, auth, vendor)

wpa3_access_points
```

    # A tibble: 8 √ó 5
      bssid             essid                privacy   auth    vendor
      <chr>             <chr>                <chr>     <chr>   <chr> 
    1 26:20:53:0C:98:E8 <NA>                 WPA3 WPA2 SAE PSK <NA>  
    2 A2:FE:FF:B8:9B:C9 Christie‚Äôs           WPA3 WPA2 SAE PSK <NA>  
    3 96:FF:FC:91:EF:64 <NA>                 WPA3 WPA2 SAE PSK <NA>  
    4 CE:48:E7:86:4E:33 iPhone (–ê–Ω–∞—Å—Ç–∞—Å–∏—è)   WPA3 WPA2 SAE PSK <NA>  
    5 8E:1F:94:96:DA:FD iPhone (–ê–Ω–∞—Å—Ç–∞—Å–∏—è)   WPA3 WPA2 SAE PSK <NA>  
    6 BE:FD:EF:18:92:44 –î–∏–º–∞—Å–∏–∫              WPA3 WPA2 SAE PSK <NA>  
    7 3A:DA:00:F9:0C:02 iPhone XS Max ü¶äüê±ü¶ä WPA3 WPA2 SAE PSK <NA>  
    8 76:C5:A0:70:08:96 <NA>                 WPA3 WPA2 SAE PSK <NA>  

#### 4. –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª—É –≤—Ä–µ–º–µ–Ω–∏, –≤ —Ç–µ—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–Ω–∏ –Ω–∞—Ö–æ–¥–∏–ª–∏—Å—å –Ω–∞ —Å–≤—è–∑–∏, –ø–æ —É–±—ã–≤–∞–Ω–∏—é

–í—ã–ø–æ–ª–Ω—è–µ–º –∞–≥—Ä–µ–≥–∞—Ü–∏—é –∑–∞–ø–∏—Å–µ–π –≤ —Å–µ—Å—Å–∏–∏ –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –°–µ—Å—Å–∏–∏ —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –ø—Ä–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ –º–µ–∂–¥—É –∑–∞–ø–∏—Å—è–º–∏ –±–æ–ª–µ–µ 45
–º–∏–Ω—É—Ç:

``` r
aggregate_access_point_sessions <- function(df, session_gap_minutes = 45) {
  df %>%
    arrange(bssid, first_seen) %>%
    group_by(bssid) %>%
    mutate(
      gap_minutes = as.numeric(difftime(first_seen, lag(last_seen), units = "mins")),
      is_new_session = if_else(is.na(gap_minutes) | gap_minutes > session_gap_minutes, 1L, 0L),
      session_id = cumsum(is_new_session)
    ) %>%
    group_by(bssid, session_id) %>%
    summarise(
      essid      = first(essid),
      vendor     = first(vendor),
      first_seen = min(first_seen, na.rm = TRUE),
      last_seen  = max(last_seen,  na.rm = TRUE),
      beacons    = sum(beacons,    na.rm = TRUE),
      speed      = max(speed,      na.rm = TRUE),
      mean_power = mean(power,     na.rm = TRUE),
      .groups    = "drop"
    ) %>%
    mutate(
      duration_seconds = as.numeric(difftime(last_seen, first_seen, units = "secs")),
      beacon_rate = beacons / duration_seconds
    )
}

wifi_ap_sessions <- aggregate_access_point_sessions(wifi_ap_clean)
```

    Warning: There were 3 warnings in `summarise()`.
    The first warning was:
    ‚Ñπ In argument: `first_seen = min(first_seen, na.rm = TRUE)`.
    ‚Ñπ In group 169: `bssid = "Station MAC"` `session_id = 1`.
    Caused by warning in `min.default()`:
    ! no non-missing arguments to min; returning Inf
    ‚Ñπ Run `dplyr::last_dplyr_warnings()` to see the 2 remaining warnings.

–í—ã–ø–æ–ª–Ω—è–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –ø–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–µ—Å—Å–∏–π:

``` r
access_points_by_duration <- wifi_ap_sessions %>%
  arrange(desc(duration_seconds)) %>%
  select(bssid, essid, vendor, session_id, duration_seconds, first_seen, last_seen)

access_points_by_duration
```

    # A tibble: 169 √ó 7
       bssid            essid vendor session_id duration_seconds first_seen         
       <chr>            <chr> <chr>       <int>            <dbl> <dttm>             
     1 00:25:00:FF:94:‚Ä¶ <NA>  Apple           1             9795 2023-07-28 09:13:06
     2 E8:28:C1:DD:04:‚Ä¶ MIRE‚Ä¶ <NA>            1             9776 2023-07-28 09:13:09
     3 E8:28:C1:DC:B2:‚Ä¶ MIRE‚Ä¶ <NA>            1             9755 2023-07-28 09:13:03
     4 08:3A:2F:56:35:‚Ä¶ <NA>  <NA>            1             9746 2023-07-28 09:13:27
     5 6E:C7:EC:16:DA:‚Ä¶ Cnet  <NA>            1             9729 2023-07-28 09:13:03
     6 E8:28:C1:DC:B2:‚Ä¶ MIRE‚Ä¶ <NA>            1             9726 2023-07-28 09:13:06
     7 48:5B:39:F9:7A:‚Ä¶ <NA>  Asust‚Ä¶          1             9725 2023-07-28 09:13:06
     8 E8:28:C1:DC:B2:‚Ä¶ <NA>  <NA>            1             9725 2023-07-28 09:13:06
     9 E8:28:C1:DC:FF:‚Ä¶ <NA>  <NA>            1             9724 2023-07-28 09:13:06
    10 8E:55:4A:85:5B:‚Ä¶ Vlad‚Ä¶ <NA>            1             9723 2023-07-28 09:13:06
    # ‚Ñπ 159 more rows
    # ‚Ñπ 1 more variable: last_seen <dttm>

#### 5. –û–±–Ω–∞—Ä—É–∂–∏—Ç—å —Ç–æ–ø-10 —Å–∞–º—ã—Ö –±—ã—Å—Ç—Ä—ã—Ö —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞

–ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ–º —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é:

``` r
top_speed_access_points <- wifi_ap_sessions %>%
  arrange(desc(speed)) %>%
  slice_head(n = 10) %>%
  select(bssid, essid, vendor, session_id, speed, first_seen, last_seen)

top_speed_access_points
```

    # A tibble: 10 √ó 7
       bssid   essid vendor session_id speed first_seen          last_seen          
       <chr>   <chr> <chr>       <int> <dbl> <dttm>              <dttm>             
     1 26:20:‚Ä¶ <NA>  <NA>            1   866 2023-07-28 09:15:45 2023-07-28 09:33:10
     2 8E:1F:‚Ä¶ iPho‚Ä¶ <NA>            1   866 2023-07-28 10:08:32 2023-07-28 10:15:27
     3 96:FF:‚Ä¶ <NA>  <NA>            1   866 2023-07-28 09:52:54 2023-07-28 10:25:02
     4 CE:48:‚Ä¶ iPho‚Ä¶ <NA>            1   866 2023-07-28 09:59:20 2023-07-28 10:04:15
     5 CA:66:‚Ä¶ <NA>  <NA>            1   858 2023-07-28 09:13:03 2023-07-28 10:59:44
     6 02:B3:‚Ä¶ HONO‚Ä¶ <NA>            1   360 2023-07-28 10:54:47 2023-07-28 10:54:47
     7 14:EB:‚Ä¶ Gnez‚Ä¶ <NA>            1   360 2023-07-28 09:25:01 2023-07-28 11:53:36
     8 4A:EC:‚Ä¶ POCO‚Ä¶ <NA>            1   360 2023-07-28 09:13:03 2023-07-28 11:04:01
     9 56:C5:‚Ä¶ OneP‚Ä¶ <NA>            1   360 2023-07-28 09:17:49 2023-07-28 10:27:22
    10 9A:75:‚Ä¶ KC    <NA>            1   360 2023-07-28 09:13:03 2023-07-28 11:53:31

#### 6. –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —á–∞—Å—Ç–æ—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (beacons) –≤ –µ–¥–∏–Ω–∏—Ü—É –≤—Ä–µ–º–µ–Ω–∏ –ø–æ –∏—Ö —É–±—ã–≤–∞–Ω–∏—é

–í—ã–ø–æ–ª–Ω—è–µ–º —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
beacon-–∫–∞–¥—Ä–æ–≤:

``` r
access_points_by_beacon_rate <- wifi_ap_sessions %>%
  filter(is.finite(beacon_rate)) %>%
  arrange(desc(beacon_rate)) %>%
  select(bssid, essid, vendor, session_id, beacons, duration_seconds, beacon_rate)

access_points_by_beacon_rate
```

    # A tibble: 126 √ó 7
       bssid            essid vendor session_id beacons duration_seconds beacon_rate
       <chr>            <chr> <chr>       <int>   <dbl>            <dbl>       <dbl>
     1 F2:30:AB:E9:03:‚Ä¶ iPho‚Ä¶ <NA>            1       6                7       0.857
     2 B2:CF:C0:00:4A:‚Ä¶ –ú–∏—Ö–∞‚Ä¶ <NA>            1       4                5       0.8  
     3 3A:DA:00:F9:0C:‚Ä¶ iPho‚Ä¶ <NA>            1       5                9       0.556
     4 00:3E:1A:5D:14:‚Ä¶ MT_F‚Ä¶ <NA>            1       1                2       0.5  
     5 02:BC:15:7E:D5:‚Ä¶ MT_F‚Ä¶ <NA>            1       1                2       0.5  
     6 76:C5:A0:70:08:‚Ä¶ <NA>  <NA>            1       1                2       0.5  
     7 D2:25:91:F6:6C:‚Ä¶ –°–∞–Ω—è  <NA>            1       5               13       0.385
     8 BE:F1:71:D6:10:‚Ä¶ C322‚Ä¶ <NA>            1    1647             9461       0.174
     9 00:03:7A:1A:03:‚Ä¶ MT_F‚Ä¶ Taiyo‚Ä¶          1       1                6       0.167
    10 38:1A:52:0D:84:‚Ä¶ EBFC‚Ä¶ <NA>            1     704             4319       0.163
    # ‚Ñπ 116 more rows

#### 7. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

–ü—Ä–∏–º–µ–Ω—è–µ–º –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é –ø—Ä–æ—Ü–µ–¥—É—Ä—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π –¥–ª—è
–∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:

``` r
wifi_clients_clean <- wifi_clients_clean %>%
  mutate(prefix6 = substr(normalize_mac(station_mac), 1, 6)) %>%
  left_join(manuf_tbl, by = "prefix6")
```

–í—ã–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö
—É—Å—Ç—Ä–æ–π—Å—Ç–≤:

``` r
wifi_clients_clean %>%
  select(station_mac, vendor, bssid, power, packets) %>%
  filter(!is.na(vendor)) %>%
  head(20)
```

    # A tibble: 8 √ó 5
      station_mac       vendor   bssid             power packets
      <chr>             <chr>    <chr>             <dbl>   <dbl>
    1 00:95:69:E7:7F:35 LsdScien <NA>                -69    2245
    2 00:95:69:E7:7C:ED LsdScien <NA>                -55    4096
    3 00:95:69:E7:7D:21 LsdScien <NA>                -33    8171
    4 B8:27:EB:59:FA:0E Raspberr 6E:C7:EC:16:DA:1A    -1     405
    5 00:90:4C:E6:54:54 Epigram  <NA>                -65      16
    6 EC:55:F9:A1:4C:6B HonHaiPr 9A:9F:06:44:24:5B    -1       1
    7 00:04:35:22:4F:75 ComptekI 00:AB:0A:00:10:10   -83      20
    8 00:0C:E7:A8:D6:73 Mediatek <NA>                -67       3

#### 8. –û–±–Ω–∞—Ä—É–∂–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï —Ä–∞–Ω–¥–æ–º–∏–∑–∏—Ä—É—é—Ç —Å–≤–æ–π MAC –∞–¥—Ä–µ—Å

–†–µ–∞–ª–∏–∑—É–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏–∏ MAC-–∞–¥—Ä–µ—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ
–∞–Ω–∞–ª–∏–∑–∞ –±–∏—Ç–æ–≤ –ø–µ—Ä–≤–æ–≥–æ –æ–∫—Ç–µ—Ç–∞:

``` r
is_randomized_mac <- function(mac_address) {
  mac_hex <- normalize_mac(mac_address)
  
  if (nchar(mac_hex) < 2) return(NA)
  
  first_octet <- strtoi(substr(mac_hex, 1, 2), base = 16)
  if (is.na(first_octet)) return(NA)
  
  if (bitwAnd(first_octet, 0x01) != 0) return(NA)
  
  bitwAnd(first_octet, 0x02) != 0
}
```

–í—ã–ø–æ–ª–Ω—è–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å –Ω–µ—Ä–∞–Ω–¥–æ–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ MAC-–∞–¥—Ä–µ—Å–∞–º–∏:

``` r
non_randomized_clients <- wifi_clients_clean %>%
  mutate(is_randomized = vapply(station_mac, is_randomized_mac, logical(1))) %>%
  filter(is_randomized == FALSE) %>%
  select(station_mac, vendor, bssid, first_seen, last_seen, power, packets)

non_randomized_clients
```

    # A tibble: 217 √ó 7
       station_mac       vendor  bssid first_seen          last_seen           power
       <chr>             <chr>   <chr> <dttm>              <dttm>              <dbl>
     1 5C:3A:45:9E:1A:7B <NA>    BE:F‚Ä¶ 2023-07-28 09:13:03 2023-07-28 11:51:54   -39
     2 C0:E4:34:D8:E7:E5 <NA>    BE:F‚Ä¶ 2023-07-28 09:13:03 2023-07-28 11:53:16   -61
     3 10:51:07:CB:33:E7 <NA>    <NA>  2023-07-28 09:13:05 2023-07-28 11:56:06   -43
     4 68:54:5A:40:35:9E <NA>    1E:9‚Ä¶ 2023-07-28 09:13:06 2023-07-28 11:50:50   -31
     5 74:4C:A1:70:CE:F7 <NA>    E8:2‚Ä¶ 2023-07-28 09:13:06 2023-07-28 09:20:01   -71
     6 BC:F1:71:D4:DB:04 <NA>    <NA>  2023-07-28 09:13:07 2023-07-28 10:57:52   -45
     7 4C:44:5B:14:76:E3 <NA>    E8:2‚Ä¶ 2023-07-28 09:13:09 2023-07-28 09:47:44    -1
     8 A0:E7:0B:AE:D5:44 <NA>    0A:C‚Ä¶ 2023-07-28 09:13:09 2023-07-28 11:34:42   -37
     9 00:95:69:E7:7F:35 LsdSci‚Ä¶ <NA>  2023-07-28 09:13:11 2023-07-28 11:56:07   -69
    10 00:95:69:E7:7C:ED LsdSci‚Ä¶ <NA>  2023-07-28 09:13:11 2023-07-28 11:56:13   -55
    # ‚Ñπ 207 more rows
    # ‚Ñπ 1 more variable: packets <dbl>

#### 9. –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∫ —Ç–æ—á–∫–∞–º –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∏—Ö –∏–º–µ–Ω–∞–º. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Ä–µ–º—è –ø–æ—è–≤–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –∑–æ–Ω–µ —Ä–∞–¥–∏–æ–≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º—è –≤—ã—Ö–æ–¥–∞ –µ–≥–æ –∏–∑ –Ω–µ–µ

–í—ã–ø–æ–ª–Ω—è–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Å–µ—Ç–µ–π (ESSID) –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π
–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏:

``` r
access_point_essid_map <- wifi_ap_clean %>%
  mutate(essid_normalized = str_squish(essid)) %>%
  select(bssid, essid_normalized) %>%
  distinct()
```

–í—ã–ø–æ–ª–Ω—è–µ–º –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å —Ç–æ—á–∫–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞:

``` r
device_network_clusters <- wifi_clients_clean %>%
  filter(!is.na(bssid)) %>%
  left_join(access_point_essid_map, by = "bssid") %>%
  filter(!is.na(essid_normalized), essid_normalized != "") %>%
  group_by(station_mac, essid_normalized) %>% 
  summarise(
    first_seen      = min(first_seen, na.rm = TRUE),
    last_seen       = max(last_seen,  na.rm = TRUE),
    duration_seconds = as.numeric(difftime(last_seen, first_seen, units = "secs")),
    record_count    = n(),
    .groups         = "drop"
  ) %>%
  arrange(desc(duration_seconds), station_mac, essid_normalized)

device_network_clusters
```

    # A tibble: 99 √ó 6
       station_mac       essid_normalized first_seen          last_seen          
       <chr>             <chr>            <dttm>              <dttm>             
     1 8C:55:4A:DE:F2:38 Galaxy A30s5208  2023-07-28 09:13:17 2023-07-28 11:56:16
     2 CA:54:C4:8B:B5:3A GIVC             2023-07-28 09:13:06 2023-07-28 11:55:04
     3 F6:4D:98:98:18:C3 GIVC             2023-07-28 09:14:37 2023-07-28 11:55:29
     4 C0:E4:34:D8:E7:E5 C322U13 3965     2023-07-28 09:13:03 2023-07-28 11:53:16
     5 5C:3A:45:9E:1A:7B C322U21 0566     2023-07-28 09:13:03 2023-07-28 11:51:54
     6 28:7F:CF:23:25:53 KC               2023-07-28 09:13:14 2023-07-28 11:51:50
     7 34:E1:2D:3C:C8:2D Cnet             2023-07-28 09:13:29 2023-07-28 11:51:50
     8 88:D8:2E:4F:9B:1A POCO X5 Pro 5G   2023-07-28 09:13:19 2023-07-28 11:51:24
     9 FE:B7:DD:ED:94:91 MIREA_HOTSPOT    2023-07-28 09:13:55 2023-07-28 11:51:47
    10 68:54:5A:40:35:9E Galaxy A71       2023-07-28 09:13:06 2023-07-28 11:50:50
    # ‚Ñπ 89 more rows
    # ‚Ñπ 2 more variables: duration_seconds <dbl>, record_count <int>

#### 10. –û—Ü–µ–Ω–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —É—Ä–æ–≤–Ω—è —Å–∏–≥–Ω–∞–ª–∞ –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏. –í—ã—è–≤–∏—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä

–í—ã–ø–æ–ª–Ω—è–µ–º –∞–Ω–∞–ª–∏–∑ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —É—Ä–æ–≤–Ω—è —Å–∏–≥–Ω–∞–ª–∞ –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ,
—Å–µ—Ç—å):

``` r
signal_stability_clusters <- wifi_clients_clean %>%
  filter(!is.na(bssid)) %>%
  left_join(access_point_essid_map, by = "bssid") %>%
  filter(!is.na(essid_normalized), essid_normalized != "") %>%
  group_by(station_mac, essid_normalized)
```

–í—ã—á–∏—Å–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–∏–≥–Ω–∞–ª–∞ –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –Ω–∞–∏–±–æ–ª–µ–µ
—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä:

``` r
signal_stability_metrics <- signal_stability_clusters %>%
  summarise(
    observation_count = n(),
    time_span_minutes = as.numeric(difftime(max(last_seen), min(first_seen), units = "mins")),
    rssi_std_dev      = sd(power, na.rm = TRUE),
    rssi_mean         = mean(power, na.rm = TRUE),
    .groups           = "drop"
  ) %>%
  arrange(rssi_std_dev)

most_stable_cluster <- slice_head(signal_stability_metrics, n = 1)

cat("–ú–µ—Ç—Ä–∏–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–∏–≥–Ω–∞–ª–∞:\n")
```

    –ú–µ—Ç—Ä–∏–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–∏–≥–Ω–∞–ª–∞:

``` r
print(signal_stability_metrics)
```

    # A tibble: 99 √ó 6
       station_mac essid_normalized observation_count time_span_minutes rssi_std_dev
       <chr>       <chr>                        <int>             <dbl>        <dbl>
     1 00:E9:3A:6‚Ä¶ POCO C40                         1            99.9             NA
     2 00:F4:8D:F‚Ä¶ Redmi 12                         1            58.4             NA
     3 02:69:A5:2‚Ä¶ Galaxy A71                       1            32.3             NA
     4 02:B3:4E:2‚Ä¶ –î–∏–º–∞—Å–∏–∫                          1             0               NA
     5 04:8C:9A:0‚Ä¶ MIREA_HOTSPOT                    1            88.1             NA
     6 06:15:2E:1‚Ä¶ MIREA_HOTSPOT                    1             2.9             NA
     7 06:7A:BA:E‚Ä¶ Vladimir                         1            18.1             NA
     8 06:F2:A9:C‚Ä¶ MIREA_HOTSPOT                    1           139.              NA
     9 0A:AB:49:3‚Ä¶ MIREA_HOTSPOT                    1            67.1             NA
    10 0A:C2:C3:0‚Ä¶ MIREA_HOTSPOT                    1             0.133           NA
    # ‚Ñπ 89 more rows
    # ‚Ñπ 1 more variable: rssi_mean <dbl>

``` r
cat("\n–ù–∞–∏–±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä:\n")
```


    –ù–∞–∏–±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä:

``` r
print(most_stable_cluster)
```

    # A tibble: 1 √ó 6
      station_mac  essid_normalized observation_count time_span_minutes rssi_std_dev
      <chr>        <chr>                        <int>             <dbl>        <dbl>
    1 00:E9:3A:67‚Ä¶ POCO C40                         1              99.9           NA
    # ‚Ñπ 1 more variable: rssi_mean <dbl>

### –®–∞–≥ 3.

–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω.

## –í—ã–≤–æ–¥

–í —Ö–æ–¥–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã —è —É–ª—É—á—à–∏–ª –Ω–∞–≤—ã–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —è–∑—ã–∫–∞
–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è R, –∞ —Ç–∞–∫–∂–µ –æ—Å–≤–æ–∏–ª –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
–±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã—Ö —Å–µ—Ç–µ–π.
